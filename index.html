<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Ad Screenshot Tool</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
    .container { max-width: 600px; margin: auto; background: #fff; padding: 20px; border-radius: 8px; }
    h1 { font-size: 1.5em; text-align: center; }
    .form-group { margin-bottom: 1em; }
    label { display: block; margin-bottom: 0.5em; font-weight: bold; }
    input[type=text], select { width: 100%; padding: 8px; box-sizing: border-box; }
    button { padding: 10px 20px; font-size: 1em; cursor: pointer; }
    #screenshot-img { max-width: 100%; margin-top: 20px; border: 1px solid #ccc; display: none; }
    #download-link { display: none; margin-top: 10px; }
  </style>
</head>
<body>
  <div class="container">
    <h1>–°–∫—Ä–∏–Ω—à–æ—Ç —Ä–µ–∫–ª–∞–º—ã VK/myTarget</h1>
    <div class="form-group">
      <label for="ad-url">–°—Å—ã–ª–∫–∞ –Ω–∞ —Ä–µ–∫–ª–∞–º—É VK –∏–ª–∏ myTarget:</label>
      <input type="text" id="ad-url" placeholder="–í—Å—Ç–∞–≤—å—Ç–µ URL —Ä–µ–∫–ª–∞–º–Ω–æ–≥–æ –æ–±—ä—è–≤–ª–µ–Ω–∏—è" />
    </div>
    <div class="form-group">
      <label for="viewport">–†–∞–∑–º–µ—Ä —ç–∫—Ä–∞–Ω–∞ (—É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ):</label>
      <select id="viewport">
        <option value="desktop" selected>–î–µ—Å–∫—Ç–æ–ø (1280√ó800)</option>
        <option value="mobile">–ú–æ–±–∏–ª—å–Ω—ã–π (375√ó800)</option>
      </select>
    </div>
    <button id="capture-btn">–°–¥–µ–ª–∞—Ç—å —Å–∫—Ä–∏–Ω—à–æ—Ç</button>
    <p id="loading" style="display:none;">‚è± –°–æ–∑–¥–∞–µ—Ç—Å—è —Å–∫—Ä–∏–Ω—à–æ—Ç, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞ –ø–æ–¥–æ–∂–¥–∏—Ç–µ...</p>
    <img id="screenshot-img" alt="–†–µ–∑—É–ª—å—Ç–∞—Ç —Å–∫—Ä–∏–Ω—à–æ—Ç–∞ –ø–æ—è–≤–∏—Ç—Å—è –∑–¥–µ—Å—å" />
    <br>
    <a id="download-link" href="#" download="screenshot.png">üì• –°–∫–∞—á–∞—Ç—å —Å–∫—Ä–∏–Ω—à–æ—Ç</a>
  </div>

  <script>
    const captureBtn = document.getElementById('capture-btn');
    const urlInput = document.getElementById('ad-url');
    const viewportSelect = document.getElementById('viewport');
    const loadingText = document.getElementById('loading');
    const screenshotImg = document.getElementById('screenshot-img');
    const downloadLink = document.getElementById('download-link');

    captureBtn.addEventListener('click', async () => {
      const url = urlInput.value.trim();
      if (!url) {
        alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ —Ä–µ–∫–ª–∞–º–Ω–æ–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ.');
        return;
      }
      // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ä–∞–∑–º–µ—Ä –æ–∫–Ω–∞ –¥–ª—è —Å–∫—Ä–∏–Ω—à–æ—Ç–∞:
      let width, height;
      if (viewportSelect.value === 'mobile') {
        width = 375; height = 800;   // –º–æ–±–∏–ª—å–Ω—ã–π –≤–∏–¥
      } else {
        width = 1280; height = 800;  // –≤–∏–¥ –¥–ª—è –¥–µ—Å–∫—Ç–æ–ø–∞
      }

      // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ —Ñ—É–Ω–∫—Ü–∏—é —Å–∫—Ä–∏–Ω—à–æ—Ç–∞
      captureBtn.disabled = true;
      loadingText.style.display = 'block';
      screenshotImg.style.display = 'none';
      downloadLink.style.display = 'none';
      try {
        const response = await fetch(`/.netlify/functions/screenshot?url=${encodeURIComponent(url)}&width=${width}&height=${height}`);
        if (!response.ok) {
          throw new Error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Å–∫—Ä–∏–Ω—à–æ—Ç–∞');
        }
        const blob = await response.blob();
        // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –ø–æ–ª—É—á–µ–Ω–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
        const imageUrl = URL.createObjectURL(blob);
        screenshotImg.src = imageUrl;
        screenshotImg.style.display = 'block';
        // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º —Å—Å—ã–ª–∫—É –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
        downloadLink.href = imageUrl;
        downloadLink.style.display = 'inline-block';
      } catch (err) {
        console.error(err);
        alert('‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å —Å–∫—Ä–∏–Ω—à–æ—Ç. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Å—ã–ª–∫—É –∏ –ø–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–æ–ø—ã—Ç–∫—É.');
      } finally {
        captureBtn.disabled = false;
        loadingText.style.display = 'none';
      }
    });
  </script>
</body>
</html>
